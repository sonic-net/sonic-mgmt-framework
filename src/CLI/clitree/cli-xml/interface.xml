<?xml version="1.0" encoding="UTF-8"?>
<!--
Copyright 2019 Dell, Inc.  

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
--> 

<CLISH_MODULE
    xmlns="http://www.dellemc.com/sonic/XMLSchema"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xsi:schemaLocation="http://www.dellemc.com/sonic/XMLSchema
    http://www.dellemc.com/sonic/XMLSchema/clish.xsd"
    >
    <VIEW name="enable-view">
	<!--show interface Ethernet <id> -->
    <COMMAND
         name="show interface"
         help="Show Interface info"
	 >
	 <PARAM
	     name="if-subcommands"
	     help="Interface subcommands"
	     mode="switch"
	     ptype="SUBCOMMAND"
	     >
	     <PARAM
		  name="counters"
		  help="Counters for Physical Interfaces"
		  ptype="SUBCOMMAND"
		  mode="subcommand"
		  >
             </PARAM>
	     <PARAM
		  name="Ethernet"
		  help="Physical Interface"
		  ptype="SUBCOMMAND"
		  mode="subcommand"
		  >
		  <PARAM
		      name="phy-if-id"
		      help="Physical interface(Multiples of 4)"
	              ptype="UINT"
		      optional="true"
		      >
		  	</PARAM>
	     </PARAM>
	     <PARAM
		  	name="port-channel"
		  	help="Port-channel Interface"
		  	ptype="SUBCOMMAND"
			mode="subcommand"
		  	>
                        <PARAM
                          name="lag-id"
                          help="PortChannel identifier"
                          ptype="UINT"
                          optional="true"
                          >
                       </PARAM>
	      </PARAM>
	      <PARAM
		  name="status"
		  help="Physical interfaces status"
		  ptype="SUBCOMMAND"
		  mode="subcommand"
		  >
	      </PARAM>
	 </PARAM>
	 <ACTION>
	    if test "${if-subcommands}" = "status"; then&#xA;
		python $SONIC_CLI_ROOT/sonic-cli-if.py get_openconfig_interfaces_interfaces show_interface_status.j2 ${__full_line}&#xA;
	    elif test "${if-subcommands}" = "counters"; then&#xA;
	        python $SONIC_CLI_ROOT/sonic-cli-if.py get_openconfig_interfaces_interfaces show_interface_counters.j2&#xA;
	    elif test "${if-subcommands}" = "port-channel"; then&#xA;
                if test "${lag-id}" = ""; then&#xA;
                    python $SONIC_CLI_ROOT/sonic-cli-if.py get_openconfig_interfaces_interfaces PortChannel show_portchannel.j2&#xA;
                else&#xA;
	            python $SONIC_CLI_ROOT/sonic-cli-if.py get_openconfig_if_aggregate_interfaces_interface_aggregation_state PortChannel${lag-id} show_portchannel_id.j2#xA;
                fi
	    else&#xA;
                if test "${phy-if-id}" = ""; then&#xA;
                    python $SONIC_CLI_ROOT/sonic-cli-if.py get_openconfig_interfaces_interfaces show_interface.j2 ${__full_line}&#xA;
                else&#xA;
                    python $SONIC_CLI_ROOT/sonic-cli-if.py get_openconfig_interfaces_interfaces_interface Ethernet${phy-if-id} show_interface_id.j2 ${__full_line}&#xA;
		fi&#xA;
	    fi
         </ACTION>
    </COMMAND>
    </VIEW>

    <VIEW
        name="configure-view"
        >
        <COMMAND
                name="interface"
                help="Select an interface"
                />

                <COMMAND
                        name="interface Ethernet"
                        help="Select an interface"
                        view="configure-if-view"
                        viewid="iface=Ethernet${phy-if-name}"
                        >
                        <PARAM
                                name="phy-if-name"
                                help="Physical interface(Multiples of 4)"
                                ptype="UINT"
                                >
                        </PARAM>
                        <ACTION builtin="clish_nop"></ACTION>
                </COMMAND>
                <COMMAND
                        name="interface vlan"
                        help="Vlan Interface Configuration"
                        mode="subcommand"
                        ptype="SUBCOMMAND"
                        view="configure-vlan-view"
                        viewid="vlan_id=vlan${vlan-id}"
                        >
                        <PARAM
                                name="vlan-id"
                                help="Vlan identifier(1-4094)"
                                ptype="UINT"
                                >
                        </PARAM>
                        <ACTION>python $SONIC_CLI_ROOT/sonic-cli-if.py patch_openconfig_interfaces_interfaces_interface Vlan${vlan-id}</ACTION>
                </COMMAND>
                <COMMAND
                        name="interface port-channel"
                        help="port-channel Interface Configuration"
                        mode="subcommand"
                        ptype="SUBCOMMAND"
                        view="configure-lag-view"
                        viewid="po_id=po${lag-id}"
                        >
                        <PARAM
                                name="lag-id"
                                help="port-channel identifier(1-128)"
                                ptype="UINT"
                                >
                        </PARAM>
                        <ACTION>python $SONIC_CLI_ROOT/sonic-cli-if.py patch_openconfig_interfaces_interfaces_interface PortChannel${lag-id}</ACTION>
                </COMMAND>

		<!-- no interface commands -->
		<COMMAND
			name="no interface"
			help="Delete interface"
			>
			<PARAM
				name="if-subcommands"
				help="Interface sub-commands"
				mode="switch"
				ptype="SUBCOMMAND"
				>
				<PARAM
					name="vlan"
					help="Delete vlan"
					mode="subcommand"
					ptype="SUBCOMMAND"
					>
					<PARAM
						name="vlan-id"
						help="Vlan identifier(1-4094)"
						ptype="UINT"
						/>
				</PARAM>
				<PARAM
					name="port-channel"
					help="Delete port-channel"
					mode="subcommand"
					ptype="SUBCOMMAND"
					>
					<PARAM
						name="lag-id"
						help="port-channel identifier(1-128)"
						ptype="UINT"
						/>
				</PARAM>
			</PARAM>
      <ACTION>
          if test "${if-subcommands}" = "vlan"; then&#xA;
              python $SONIC_CLI_ROOT/sonic-cli-if.py delete_openconfig_interfaces_interfaces_interface Vlan${vlan-id}&#xA;
          fi&#xA;
          if test "${if-subcommands}" = "port-channel"; then&#xA;
              python $SONIC_CLI_ROOT/sonic-cli-if.py delete_openconfig_interfaces_interfaces_interface PortChannel${lag-id}&#xA;
          fi
      </ACTION>
    </COMMAND>
    </VIEW>
    <VIEW
        name="configure-if-view"
        prompt="${SYSTEM_NAME}(conf-if-${iface})# "
        depth="2"
        >
        <!-- Inheritance -->
        <NAMESPACE
            ref="configure-view"
            help="false"
            completion="false"
            />
        <COMMAND
            name="no"
            help="Negate a command or set its defaults"
            />
        <COMMAND
            name="description"
            help="Textual description">
           <PARAM
                name="desc"
                help="Textual description of the interface"
                ptype="STRING" />
           <ACTION>python $SONIC_CLI_ROOT/sonic-cli-if.py patch_openconfig_interfaces_interfaces_interface_config_description ${iface} ${desc} </ACTION>
        </COMMAND>

        <COMMAND
            name="no description"
            help="Remove description" >
	    <ACTION>python $SONIC_CLI_ROOT/sonic-cli-if.py patch_openconfig_interfaces_interfaces_interface_config_description ${iface} "" </ACTION>
        </COMMAND>
        <COMMAND
            name="mtu"
            help="Configure MTU">
	    <PARAM 
                name="mtu" 
                help="MTU of the interface"
                ptype="RANGE_MTU" />
	    <ACTION>python $SONIC_CLI_ROOT/sonic-cli-if.py patch_openconfig_interfaces_interfaces_interface_config_mtu ${iface} ${mtu} </ACTION>
        </COMMAND>
	<COMMAND
            name="no mtu"
            help="Remove MTU">
            <ACTION>python $SONIC_CLI_ROOT/sonic-cli-if.py patch_openconfig_interfaces_interfaces_interface_config_mtu ${iface} 9100 </ACTION>
        </COMMAND>
        <COMMAND
            name="channel-group"
            help="Configure port channel parameters">
	    <PARAM 
                name="lag-id" 
                help="Specify a port channel number"
                ptype="UINT" />
	    <ACTION>python $SONIC_CLI_ROOT/sonic-cli-if.py patch_openconfig_if_aggregate_interfaces_interface_ethernet_config_aggregate_id ${iface} ${lag-id} </ACTION>
        </COMMAND>
        <COMMAND
            name="no channel-group"
            help="Remove from port channel group">
	    <ACTION>python $SONIC_CLI_ROOT/sonic-cli-if.py delete_openconfig_if_aggregate_interfaces_interface_ethernet_config_aggregate_id ${iface} </ACTION>
        </COMMAND>
        <COMMAND 
            name="shutdown"
            help="Disable the interface">
	    <ACTION>python $SONIC_CLI_ROOT/sonic-cli-if.py patch_openconfig_interfaces_interfaces_interface_config_enabled ${iface} False </ACTION>
        </COMMAND>
        <COMMAND
            name="no shutdown"
            help="Enable the interface">
	    <ACTION>python $SONIC_CLI_ROOT/sonic-cli-if.py patch_openconfig_interfaces_interfaces_interface_config_enabled ${iface} True </ACTION>
        </COMMAND>
		<COMMAND
			name="switchport"
			help="Configure switchport parameters"
			>
			<PARAM
				name="switchport-subcommands"
				help="Switchport subcommands"
				ptype="SUBCOMMAND"
				mode="switch"
				>
				<!--
				<PARAM
					name="mode"
					help="Enter the port mode access/trunk"
					ptype="SUBCOMMAND"
					mode="subcommand"
					>
					<PARAM
						name="mode subcommands"
						help="Mode Subcommands"
						ptype="SUBCOMMAND"
						mode="switch"
						>
						<PARAM
							name="access"
							help="Port mode access"
							ptype="SUBCOMMAND"
							mode="subcommand"
							>
						</PARAM>
					</PARAM>
				</PARAM>
				-->

				<PARAM
					name="access"
					help="Set access mode characteristics of the interface"
					ptype="SUBCOMMAND"
					mode="subcommand"
					>
					<PARAM
						name="vlan"
						help="Set VLAN when interface is in access mode"
						ptype="SUBCOMMAND"
						mode="subcommand"
						>
						<PARAM
							name="vlan-id"
							help="VLAN ID of the VLAN when this port is in access mode"
							ptype="UINT"
							>
						</PARAM>
					</PARAM>
				</PARAM>

				<PARAM
					name="trunk"
					help="Configure trunking parameters on an interface"
					ptype="SUBCOMMAND"
					mode="subcommand"
					>
					<PARAM
						name="allowed"
						help="Configure trunking parameters on an interface"
						ptype="SUBCOMMAND"
						mode="subcommand"
						>
						<PARAM
							name="vlan"
							help="Configure trunking parameters on an interface"
							ptype="SUBCOMMAND"
							mode="subcommand"
							>
							<PARAM
								name="vlan-id"
                            	help="VLAN ID of the VLAN when this port is in access mode"
                            	ptype="UINT"
                            	>
                        	</PARAM>
						</PARAM>
					</PARAM>
				</PARAM>
			</PARAM>
                <ACTION>
                     if test "${switchport-subcommands}" = "access"; then&#xA;
                         python $SONIC_CLI_ROOT/sonic-cli-if.py patch_openconfig_vlan_interfaces_interface_ethernet_switched_vlan_config ${iface} ACCESS ${vlan-id}&#xA;
                     else&#xA;
                         python $SONIC_CLI_ROOT/sonic-cli-if.py patch_openconfig_vlan_interfaces_interface_ethernet_switched_vlan_config ${iface} TRUNK ${vlan-id}&#xA;
                    fi

                </ACTION>
	</COMMAND>

	<COMMAND
		name="no switchport"
		help="Remove switchport parameters"
		>
		<PARAM
			name="switchport-subcommands"
			help="Switchport subcommands"
			ptype="SUBCOMMAND"
			mode="switch"
			>
			<PARAM
				name="access"
				help="Remove access mode characteristics of the interface"
				ptype="SUBCOMMAND"
				mode="subcommand"
				>
				<PARAM
					name="vlan"
					help="Remove VLAN when interface is in access mode"
					ptype="SUBCOMMAND"
					mode="subcommand"
					>
					</PARAM>
			</PARAM>

			<PARAM
				name="trunk"
				help="Remove trunking parameters on an interface"
				ptype="SUBCOMMAND"
				mode="subcommand"
				>
				<PARAM
					name="allowed"
					help="Remove trunking parameters on an interface"
					ptype="SUBCOMMAND"
					mode="subcommand"
					>
					<PARAM
						name="vlan"
						help="Remove trunking parameters on an interface"
						ptype="SUBCOMMAND"
						mode="subcommand"
						>
						<PARAM
							name="vlan-id"
							help="VLAN ID of the VLAN when this port is in access mode"
							ptype="UINT"
							>
						</PARAM>
					</PARAM>
				</PARAM>
			</PARAM>
		</PARAM>
	<ACTION>
		if test "${switchport-subcommands}" = "access"; then&#xA;
			python $SONIC_CLI_ROOT/sonic-cli-if.py delete_openconfig_vlan_interfaces_interface_ethernet_switched_vlan_config_access_vlan ${iface} ACCESS&#xA;
		else&#xA;
			python $SONIC_CLI_ROOT/sonic-cli-if.py delete_openconfig_vlan_interfaces_interface_ethernet_switched_vlan_config_trunk_vlans ${iface} TRUNK ${vlan-id}&#xA;
		fi

	</ACTION>
	</COMMAND>
	</VIEW>
	
    <VIEW
        name="configure-vlan-view"
        prompt="${SYSTEM_NAME}(conf-if-${vlan_id})# "
        depth="2"
        >
        <!-- Inheritance -->
        <NAMESPACE
            ref="configure-view"
            help="false"
            completion="false"
            />
    </VIEW>
    <VIEW
        name="configure-lag-view"
        prompt="${SYSTEM_NAME}(conf-if-${po_id})# "
        depth="2"
        >
        <!-- Inheritance -->
        <NAMESPACE
            ref="configure-view"
            help="false"
            completion="false"
            />

        <COMMAND
            name="no"
            help="Negate a command or set its defaults"
            />
        <COMMAND 
            name="min-links"
            help="Configure the minimum number of links in a port-channel">
	    <PARAM 
                name="min-links"
                help="Configure the minimum number of links in a port-channel"
                ptype="UINT" />
	    <ACTION>python $SONIC_CLI_ROOT/sonic-cli-if.py patch_openconfig_if_aggregate_interfaces_interface_aggregation_config_min_links ${po_id} ${min-links} </ACTION>
        </COMMAND>
        <COMMAND
            name="no min-links"
            help="Default the minimum number of links in a port channel" >
	    <ACTION>python $SONIC_CLI_ROOT/sonic-cli-if.py patch_openconfig_if_aggregate_interfaces_interface_aggregation_config_min_links ${po_id} 1 </ACTION>
        </COMMAND>
        <COMMAND
            name="mtu"
            help="Configure MTU">
	    <PARAM 
                name="mtu" 
                help="MTU of the interface"
                ptype="RANGE_MTU" />
	    <ACTION>python $SONIC_CLI_ROOT/sonic-cli-if.py patch_openconfig_interfaces_interfaces_interface_config_mtu ${po_id} ${mtu} </ACTION>
        </COMMAND>
	<COMMAND
            name="no mtu"
            help="Remove MTU">
            <ACTION>python $SONIC_CLI_ROOT/sonic-cli-if.py patch_openconfig_interfaces_interfaces_interface_config_mtu ${po_id} 9100 </ACTION>
        </COMMAND>
        <COMMAND 
            name="shutdown"
            help="Disable the interface">
        </COMMAND>
        <COMMAND 
            name="no shutdown"
            help="Enable the interface">
        </COMMAND>
        <COMMAND
            name="ip"
            help="Interface Internet Protocol config commands"
        />
        <COMMAND
            name="no ip"
            help="Interface Internet Protocol config commands"
            >
        </COMMAND>

        <COMMAND
            name="ip address"
            help="IP address" >
            <PARAM
                name="addr"
                help="IP address with mask"
                ptype="IP_ADDR_MASK" />
        </COMMAND>

        <COMMAND
            name="no ip address"
            help="Interface Internet Protocol config commands"
            >
            <PARAM
                name="addr"
                help="IP address"
                ptype="IP_ADDR" />
        </COMMAND>
	</VIEW>
    </CLISH_MODULE>

